var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,s=(e,l)=>{for(var t in l||(l={}))d.call(l,t)&&n(e,t,l[t]);if(a)for(var t of a(l))o.call(l,t)&&n(e,t,l[t]);return e};import{_ as r,a as u,b as i,c}from"./index.fb1a27f8.js";import{d as v,J as m,N as w,O as p,u as h,af as b,p as g,h as f,f as y,o as I,c as N,F as C,i as O,t as R,a as D,j as k,w as M,q as V,g as j,z as T,U as x}from"./vendor.43fb884e.js";var B=v({components:{VInput:r,VNumber:u,VGroup:i,VButton:c},props:{selected:{type:Object,default:()=>null}},setup(e){const l=m(),t=w(),a=p("statment"),d=h((()=>t.params.name)),o=h({get(){var t,a,o,n,s,r,u,i;const c=l.state.modifications[d.value].data.updates;return(null==(t=e.selected)?void 0:t.new)?null!=(r=null==(s=null==(o=l.state.modifications[d.value])?void 0:o.data.new[null==(a=e.selected)?void 0:a.rowId])?void 0:s[null==(n=e.selected)?void 0:n.column])?r:null:e.selected&&void 0!==(null==(u=null==c?void 0:c[e.selected.rowId])?void 0:u[e.selected.column])?null==(i=null==c?void 0:c[e.selected.rowId])?void 0:i[e.selected.column]:e.selected?e.selected.value:void 0},set(t){var a,o,n,s,r,u;l.commit((null==(a=e.selected)?void 0:a.new)?"setModifiedDataNew":"setModifiedDataUpdate",{tableName:d.value,columnName:null==(o=e.selected)?void 0:o.column,[(null==(n=e.selected)?void 0:n.new)?"newIndex":"rowNumber"]:null==(s=e.selected)?void 0:s.rowId,updateValue:(null==(r=e.selected)?void 0:r.value)!==t||(null==(u=e.selected)?void 0:u.new)?t:void 0})}}),n=h((()=>{var t,a,o;return void 0!==(null==(t=e.selected)?void 0:t.column)?null==(o=l.state.tables[d.value].columns)?void 0:o[null==(a=e.selected)?void 0:a.column]:void 0})),s=h((()=>{var e,l;const t=null==(l=null==(e=n.value)?void 0:e.type)?void 0:l.toUpperCase();return void 0===t?void 0:t.includes("INT")?"number":t.includes("CHAR")||t.includes("CLOB")||t.includes("TEXT")||t.includes("BLOB")||""===t?"input":t.includes("REAL")||t.includes("FLOA")||t.includes("DOUB")?"number":"input"})),r=h((()=>{const e=l.state.modifications[d.value].data;return e.new.length>0||e.delete.length>0||Object.values(e.updates).some((e=>Object.values(e).some((e=>void 0!==e))))})),u=h((()=>{var t;return e.selected&&!e.selected.new&&l.state.modifications[d.value].data.delete.includes(null==(t=e.selected)?void 0:t.row)}));return{inputType:s,tableName:d,column:n,currentValue:o,tableHasChanges:r,revertTableChanges:()=>{l.commit("setModifiedData",{tableName:d.value,dataValue:{updates:{},new:[],delete:[]}})},commit:async()=>{await l.dispatch("alterTableData",{tableName:d.value}),a&&b(a)},addRow:()=>{l.commit("setModifiedDataNew",{tableName:d.value,newIndex:l.state.modifications[d.value].data.new.length})},deleteRow:()=>{e.selected&&e.selected.new?l.commit("deleteModifiedDataNew",{tableName:d.value,newIndex:e.selected.row-1}):e.selected&&l.commit("setModifiedDataDelete",{tableName:d.value,rowNumber:e.selected.rowId})},rowDeleted:u}}});const $=M();g("data-v-0f1c41eb");const _={class:"data-editor"},A={key:1};f();const S=$(((e,l,t,a,d,o)=>{var n,s;const r=y("v-button");return I(),N("div",_,[e.selected?(I(),N(C,{key:0},[O("h1",null,R(e.tableName)+"."+R(e.selected.column)+" @ row "+R(e.selected.new?"+":"")+" "+R(e.selected.row+1),1),(I(),N(D(`v-${e.inputType}`),{modelValue:e.currentValue,"onUpdate:modelValue":l[1]||(l[1]=l=>e.currentValue=l),placeholder:null===e.currentValue?"null":"",variant:"primary"},null,8,["modelValue","placeholder"])),(null==(n=e.column)?void 0:n.notNull)?k("",!0):(I(),N(r,{key:0,text:"Set Null",variant:"primary",onClick:l[2]||(l[2]=l=>e.currentValue=null)})),(null==(s=e.selected)?void 0:s.new)?k("",!0):(I(),N(r,{key:1,text:"Revert changes",variant:"error",disabled:e.currentValue===e.selected.value,onClick:l[3]||(l[3]=l=>e.currentValue=void 0)},null,8,["disabled"]))],64)):(I(),N("h1",A," Select a cell to edit it ")),O(r,{class:"mt-auto",text:e.rowDeleted?"Restore row":"Delete row",variant:"error",disabled:!e.selected,onClick:e.deleteRow},null,8,["text","disabled","onClick"]),O(r,{class:"mb-2",text:"Add row",variant:"primary",onClick:e.addRow},null,8,["onClick"]),O(r,{text:"Commit changes",variant:"success",disabled:!e.tableHasChanges,onClick:e.commit},null,8,["disabled","onClick"]),O(r,{text:"Disscard changes",variant:"error",disabled:!e.tableHasChanges,onClick:e.revertTableChanges},null,8,["disabled","onClick"])])}));B.render=S,B.__scopeId="data-v-0f1c41eb";var E=v({props:{value:{type:[String,Number],default:null},header:{type:Boolean,default:!1},start:{type:Boolean,default:!1},end:{type:Boolean,default:!1},highlight:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},modified:{type:Boolean,default:!1},deleted:{type:Boolean,default:!1}},setup:()=>({})});const U=M()(((e,l,t,a,d,o)=>(I(),N("div",{class:{header:e.header,start:e.start,end:e.end,highlight:e.highlight,selected:e.selected,modified:e.modified,deleted:e.deleted,null:null===e.value}},R(null===e.value?"null":e.value),3))));E.render=U,E.__scopeId="data-v-50a7b654";var L=v({components:{TableDataCell:E},props:{headers:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},selected:{type:Object,default:()=>null},rowId:{type:String,required:!0}},emits:["update:selected"],setup(e){const l=m(),t=w(),a=V({row:-1,col:-1}),d=h((()=>{var e;return null==(e=l.state.modifications[t.params.name])?void 0:e.data.updates})),o=h((()=>{var e,a;return null!=(a=null==(e=l.state.modifications[t.params.name])?void 0:e.data.new)?a:[]})),n=h((()=>[...e.rows.map((e=>({value:e,new:!1}))),...o.value.map((e=>({value:e,new:!0})))])),s=h((()=>l.state.modifications[t.params.name].data.delete));return{hovering:a,updates:d,newRows:o,allRows:n,deletedRows:s}}});const P=M()(((e,l,t,a,d,o)=>{const n=y("table-data-cell");return I(),N("div",{style:`--cols: ${e.headers.length+1}; --rows: ${e.rows.length+1}`,class:"table",onMouseleave:l[5]||(l[5]=l=>e.hovering=e.selected)},[O("div",{onMouseover:l[1]||(l[1]=j((l=>e.hovering=e.selected),["self"]))},null,32),(I(!0),N(C,null,T(e.headers,((t,a)=>(I(),N(n,{key:`header-${t}`,value:t,header:!0,highlight:e.hovering.col===a,class:"top",onMouseover:l[2]||(l[2]=l=>e.hovering=e.selected)},null,8,["value","highlight"])))),128)),(I(!0),N(C,null,T(e.allRows,(({value:t,new:a},d)=>(I(),N(C,{key:d},[O(n,{header:!0,value:a?"+"+(d-e.rows.length+1):d+1,highlight:e.hovering.row===(a?d-e.rows.length+1:d),class:"left col-start-1",onMouseover:l[3]||(l[3]=l=>e.hovering=e.selected)},null,8,["value","highlight"]),(I(!0),N(C,null,T(e.headers,((l,o)=>{var s,r,u,i,c,v,m;return I(),N(n,{key:`${d}-${o}`,start:0===o,end:o===e.headers.length-1,value:void 0!==(null==(r=null==(s=e.updates)?void 0:s[t[e.rowId]])?void 0:r[l])?null==(i=null==(u=e.updates)?void 0:u[t[e.rowId]])?void 0:i[l]:null!=(c=t[l])?c:null,highlight:e.hovering.col===o&&e.hovering.row===(a?d-e.rows.length+1:d),selected:e.selected.new===a&&e.selected.col===o&&e.selected.row===(a?d-e.rows.length+1:d),modified:void 0!==(null==(m=null==(v=e.updates)?void 0:v[t[e.rowId]])?void 0:m[e.headers[o]])&&e.updates[t[e.rowId]][e.headers[o]]!==t[l],deleted:!a&&e.deletedRows.includes(t[e.rowId]),onMouseover:l=>e.hovering={col:o,row:a?d-e.rows.length+1:d},onMousedown:l=>e.$emit("update:selected",{new:a,col:o,row:a?d-e.rows.length+1:d})},null,8,["start","end","value","highlight","selected","modified","deleted","onMouseover","onMousedown"])})),128))],64)))),128)),O("span",{class:"w-full",style:`grid-row: 1 / ${e.allRows.length+2}; grid-column: -1;`,onMouseover:l[4]||(l[4]=j((l=>e.hovering=e.selected),["self"]))},null,36)],36)}));L.render=P,L.__scopeId="data-v-7181b452";var H=v({components:{TableDataTable:L,TableDataEditor:B},props:{name:{type:String,required:!0}},setup(e){const l=m(),t=h((()=>{var t;return null==(t=l.state.database)?void 0:t.connection.prepare(`SELECT ROWID, * FROM [${e.name}]`)})),a=h((()=>{var e;return null==(e=t.value)?void 0:e.getColumnNames()[0]})),d=h((()=>{var e;return null==(e=t.value)?void 0:e.getColumnNames().slice(1)})),o=h((()=>{if(t.value){const e=[];for(;t.value.step();){const l=t.value.getAsObject();e.push(l)}return t.value.reset(),e}}));x("statment",t);return{columnNames:d,dataRows:o,selected:V({row:-1,col:-1}),rowId:a}}});const q=M()(((e,a,d,o,n,r)=>{var u,i,c,v;const m=y("table-data-table"),w=y("table-data-editor");return I(),N("main",null,[O(m,{selected:e.selected,"onUpdate:selected":a[1]||(a[1]=l=>e.selected=l),headers:e.columnNames,rows:e.dataRows,"row-id":e.rowId},null,8,["selected","headers","rows","row-id"]),O(w,{selected:-1!==e.selected.row&&-1!==e.selected.col?(p=s({},e.selected),h={value:null==(i=null==(u=e.dataRows)?void 0:u[e.selected.row])?void 0:i[e.columnNames[e.selected.col]],column:e.columnNames[e.selected.col],rowId:null==(v=null==(c=e.dataRows)?void 0:c[e.selected.row])?void 0:v[e.rowId]},l(p,t(h))):null},null,8,["selected"])]);var p,h}));H.render=q,H.__scopeId="data-v-78611722";export{H as default};
